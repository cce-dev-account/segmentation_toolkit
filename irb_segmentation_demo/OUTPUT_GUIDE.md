# Output Files Guide

This guide explains how to read and interpret the output files generated by the segmentation framework.

---

## Output Files Overview

After running a demo, you'll find these files in `output/demo_<dataset>/`:

| File | Format | Best For | Opens With |
|------|--------|----------|------------|
| `segment_rules.txt` | Text | Quick review, documentation | Any text editor |
| `segment_summary.xlsx` | Excel | Business users, presentations | Excel, LibreOffice |
| `dashboard.html` | HTML | Visual analysis, reporting | Web browser |
| `baseline_report.json` | JSON | Technical analysis, auditing | Text editor, JSON viewer |
| `config_template.xlsx` | Excel | Editing configuration | Excel, LibreOffice |

---

## 1. segment_rules.txt (Human-Readable Rules)

**Purpose:** Quick understanding of segment definitions and risk levels

**Example:**
```
================================================================================
SEGMENT DEFINITIONS AND STATISTICS
================================================================================

SEGMENT 1: Low Risk
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”œâ”€ Observations: 127,542 (13.3%)
â”œâ”€ Defaults: 3,826 (3.0% default rate)
â”œâ”€ Segment Density: 13.3%
â””â”€ Risk Level: ðŸŸ¢ LOW RISK

Segment Rules:
   IF credit_score > 680
   AND interest_rate <= 15.0
   AND grade IN ['A', 'B', 'C']
   THEN assign to Segment 1

Statistical Validation:
   âœ“ Minimum defaults met (3,826 â‰¥ 500)
   âœ“ Density within limits (13.3% between 5% and 40%)
   âœ“ Default rate: 3.0%

SEGMENT 2: Medium Risk
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”œâ”€ Observations: 215,893 (22.5%)
â”œâ”€ Defaults: 15,112 (7.0% default rate)
â”œâ”€ Segment Density: 22.5%
â””â”€ Risk Level: ðŸŸ¡ MEDIUM RISK

Segment Rules:
   IF credit_score > 680
   AND interest_rate > 15.0
   OR (credit_score <= 680 AND dti <= 25.0)
   THEN assign to Segment 2
```

**How to Read:**
- **Observations:** Number of records in segment
- **Defaults:** Number of defaults, with default rate percentage
- **Segment Density:** % of total population
- **Risk Level:** Color-coded risk category
- **Rules:** IF...THEN conditions for segment assignment
- **Validation:** Checks that passed (âœ“) or failed (âœ—)

**Risk Level Colors:**
- ðŸŸ¢ LOW RISK: PD < 5%
- ðŸŸ¡ MEDIUM RISK: 5% â‰¤ PD < 15%
- ðŸŸ  MEDIUM-HIGH RISK: 15% â‰¤ PD < 25%
- ðŸ”´ HIGH RISK: PD â‰¥ 25%

---

## 2. segment_summary.xlsx (Excel Summary)

**Purpose:** Formatted table for business users and presentations

**Sheet: "Segment Summary"**

| Segment ID | Observations | Defaults | Default Rate | Density | Risk Level |
|------------|-------------|----------|--------------|---------|------------|
| 1 | 127,542 | 3,826 | 3.0% | 13.3% | Low |
| 2 | 215,893 | 15,112 | 7.0% | 22.5% | Medium |
| 3 | 184,729 | 27,709 | 15.0% | 19.3% | Medium-High |
| 4 | 48,235 | 12,156 | 25.2% | 5.0% | High |

**Columns Explained:**
- **Segment ID:** Unique identifier (1, 2, 3, ...)
- **Observations:** Number of records
- **Defaults:** Number of defaults
- **Default Rate:** PD = Defaults / Observations (%)
- **Density:** % of total population
- **Risk Level:** Risk category based on PD

**Formatting:**
- Color-coded risk levels (green â†’ red)
- Percentage formatting
- Thousands separator for large numbers
- Bold headers

**Use Cases:**
- Copy/paste into presentations
- Share with business stakeholders
- Import into other analysis tools

---

## 3. dashboard.html (Interactive Visualization)

**Purpose:** Visual exploration and presentation

**Open with:** Any web browser (Chrome, Firefox, Edge, Safari)

**Sections:**

### Summary Statistics
```
Total Observations: 958,399
Total Defaults: 58,803
Overall Default Rate: 6.1%
Number of Segments: 4
```

### Segment Distribution (Bar Chart)
- X-axis: Segment IDs
- Y-axis: Number of observations
- Shows relative size of each segment

### Default Rate by Segment (Bar Chart)
- X-axis: Segment IDs
- Y-axis: Default rate (%)
- Color-coded by risk level
- Shows risk separation

### Segment Details Table
Interactive table with all segment statistics

### Validation Results
- âœ“ Chi-squared test: PASSED
- âœ“ PSI test: PASSED (0.042 < 0.10)
- âœ“ Binomial test: PASSED

**Features:**
- Self-contained (works offline)
- No external dependencies
- Print-friendly
- Embeddable in reports

---

## 4. baseline_report.json (Complete Report)

**Purpose:** Technical analysis, auditing, model validation

**Structure:**
```json
{
  "config": { ... },           // Full configuration used
  "data_summary": { ... },     // Dataset statistics
  "segments": [ ... ],         // Detailed segment information
  "validation": { ... },       // All validation test results
  "metadata": { ... }          // Timestamps, versions
}
```

**Key Sections:**

### Data Summary
```json
"data_summary": {
  "train": {
    "n_observations": 95902,
    "n_defaults": 15234,
    "default_rate": 0.1588,
    "time_period": "2007-2012"
  },
  "validation": {
    "n_observations": 357907,
    "n_defaults": 28156,
    "default_rate": 0.0787,
    "time_period": "2013-2014"
  },
  "oot": {
    "n_observations": 894290,
    "n_defaults": 31647,
    "default_rate": 0.0354,
    "time_period": "2015+"
  }
}
```

### Segment Details
```json
"segments": [
  {
    "segment_id": 1,
    "n_obs": 127542,
    "n_defaults": 3826,
    "default_rate": 0.0300,
    "density": 0.1331,
    "rules": [
      {"feature": "credit_score", "operator": ">", "threshold": 680},
      {"feature": "interest_rate", "operator": "<=", "threshold": 15.0}
    ],
    "pd_estimate": 0.0300,
    "pd_confidence_interval": [0.0290, 0.0310]
  }
]
```

### Validation Results
```json
"validation": {
  "training": {
    "chi_squared": {
      "test_name": "Chi-Squared Test",
      "passed": true,
      "statistic": 45823.45,
      "p_value": 0.0,
      "threshold": 0.01
    },
    "psi": {
      "test_name": "Population Stability Index",
      "passed": true,
      "psi_value": 0.042,
      "threshold": 0.10,
      "segments": [
        {"segment_id": 1, "train_pct": 13.3, "val_pct": 13.8, "psi": 0.002}
      ]
    }
  }
}
```

**Use Cases:**
- Model validation documentation
- Regulatory submissions
- Automated processing
- Performance tracking over time

---

## 5. config_template.xlsx (Editable Configuration)

**Purpose:** Edit configuration parameters in Excel, then convert back to YAML

**Sheet: "Configuration"**

| Parameter | Value | Description |
|-----------|-------|-------------|
| max_depth | 5 | Maximum tree depth |
| min_samples_leaf | 10000 | Minimum observations per segment |
| min_defaults_per_leaf | 500 | Minimum defaults per segment |

**How to Use:**
1. Open `config_template.xlsx`
2. Edit parameter values
3. Save the file
4. Convert back to YAML (requires conversion script)

---

## Understanding Validation Results

### Chi-Squared Test
**Purpose:** Tests if segments have statistically different default rates

**Interpretation:**
- âœ“ PASSED: Segments are significantly different (p < 0.01)
- âœ— FAILED: Segments not sufficiently different â†’ Need better separation

**Action if failed:**
- Increase `min_default_rate_diff`
- Add more forced splits
- Increase `max_depth`

### PSI (Population Stability Index)
**Purpose:** Tests if segment distribution is stable across time periods

**Interpretation:**
- PSI < 0.10: âœ“ STABLE (population similar across periods)
- 0.10 â‰¤ PSI < 0.25: âš ï¸ MODERATE shift
- PSI â‰¥ 0.25: âœ— UNSTABLE (significant population shift)

**Action if failed:**
- Investigate population changes
- Consider retraining with recent data
- Review temporal split strategy

### Binomial Confidence Intervals
**Purpose:** Estimates precision of default rate estimates

**Interpretation:**
- Narrow intervals: High precision (large segment)
- Wide intervals: Low precision (small segment)

**Example:**
```
Segment 1: PD = 3.0% [2.9% - 3.1%]  â†’ Precise estimate
Segment 4: PD = 25.2% [24.5% - 25.9%] â†’ Less precise
```

---

## Common Patterns

### Good Segmentation
```
Segment 1: 3.0% default rate  (Low Risk)
Segment 2: 7.0% default rate  (Medium Risk)
Segment 3: 15.0% default rate (Medium-High Risk)
Segment 4: 25.2% default rate (High Risk)

âœ“ Clear risk separation (3% â†’ 7% â†’ 15% â†’ 25%)
âœ“ All validations passed
âœ“ Reasonable densities (5% - 25%)
```

### Problematic Segmentation
```
Segment 1: 5.8% default rate
Segment 2: 6.2% default rate  â† Too similar to Segment 1
Segment 3: 5.9% default rate  â† Too similar

âœ— Chi-squared test failed
âœ— Insufficient risk separation
```

**Fix:** Increase `min_default_rate_diff` from 0.001 to 0.01

---

## Exporting and Sharing

### For Business Users
Share: `segment_rules.txt` + `segment_summary.xlsx` + `dashboard.html`

### For Technical Users
Share: `baseline_report.json` + `segment_rules.txt`

### For Regulatory Review
Share: All files + configuration YAML

### For Presentations
Use: `dashboard.html` (open in browser, take screenshots)
Or: Copy tables from `segment_summary.xlsx`

---

## Next Steps

1. **Review segment rules** in `segment_rules.txt`
2. **Check validation results** in `dashboard.html`
3. **Share Excel summary** with business stakeholders
4. **Archive JSON report** for audit trail

For questions about specific metrics, see the validation test descriptions in `baseline_report.json`.
